!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){e.exports=n(1)(0)},function(e,t){e.exports=vendor_9b384ce89482150869b3},function(e,t,n){e.exports=n(1)(5)},function(e,t,n){e.exports=n(1)(4)},function(e,t,n){e.exports=function(){"use strict";var e=function(){var t=0,n=document.createElement("div");function a(e){return n.appendChild(e.dom),e}function o(e){for(var a=0;a<n.children.length;a++)n.children[a].style.display=a===e?"block":"none";t=e}n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),o(++t%n.children.length)},!1);var i=(performance||Date).now(),r=i,s=0,l=a(new e.Panel("FPS","#0ff","#002")),d=a(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=a(new e.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:n,addPanel:a,showPanel:o,begin:function(){i=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(d.update(e-i,200),r+1e3<=e&&(l.update(1e3*s/(e-r),100),r=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:n,setMode:o}};return e.Panel=function(e,t,n){var a=1/0,o=0,i=Math.round,r=i(window.devicePixelRatio||1),s=80*r,l=48*r,d=3*r,c=2*r,u=3*r,p=15*r,f=74*r,h=30*r,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*r+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,s,l),y.fillStyle=t,y.fillText(e,d,c),y.fillRect(u,p,f,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u,p,f,h),{dom:m,update:function(l,v){a=Math.min(a,l),o=Math.max(o,l),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,s,p),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(a)+"-"+i(o)+")",d,c),y.drawImage(m,u+r,p,f-r,h,u,p,f-r,h),y.fillRect(u+f-r,p,r,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u+f-r,p,r,i((1-l/v)*h))}}},e}()},function(e,t,n){e.exports=n(1)(9)},function(e,t,n){"use strict";n.r(t);var a=n(0),o=(n(3),n(4)),i=n.n(o),r=function e(){document.addEventListener("keydown",e.onKeyDown,!1),document.addEventListener("keyup",e.onKeyUp,!1)};r.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},r.status={},r.keyName=function(e){return null!=r.k[e]?r.k[e]:String.fromCharCode(e)},r.onKeyUp=function(e){e.preventDefault();var t=r.keyName(e.keyCode);r.status[t]&&(r.status[t].pressed=!1)},r.onKeyDown=function(e){e.preventDefault();var t=r.keyName(e.keyCode);r.status[t]||(r.status[t]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},r.prototype.update=function(){for(var e in r.status)r.status[e].updatedPreviously?r.status[e].down=!1:(r.status[e].down=!0,r.status[e].pressed=!0,r.status[e].updatedPreviously=!0),r.status[e].up?delete r.status[e]:r.status[e].pressed||(r.status[e].up=!0)},r.prototype.down=function(e){return r.status[e]&&r.status[e].down},r.prototype.pressed=function(e){return r.status[e]&&r.status[e].pressed},r.prototype.up=function(e){return r.status[e]&&r.status[e].up},r.prototype.debug=function(){var e="Keys active: ";for(var t in r.status)e+=" "+t;console.log(e)};var s,l,d=r;var c=n(2);var u=n(5),p=n.n(u);function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var h,m,y,v,w,g,b=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.angle=0,this.pos=new a.Vector3(0,0,0),this.body=t.scene,""!==n&&(this.text=new c.SpriteText2D(n,{align:c.textAlign.center,font:"40px Arial",fillStyle:"#ff0000"}),this.text.scale.set(.01,.01,.01),this.text.position.y=5,this.body.add(this.text)),o&&(o.position.set(0,5,-20),o.lookAt(new a.Vector3),this.body.add(o)),this.actions={},this.mixer=new a.AnimationMixer(t.scene),this.states=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],this.emotes=["Jump","Yes","No","Wave","Punch","ThumbsUp"];for(var i=0;i<t.animations.length;i++){var r=t.animations[i],l=this.mixer.clipAction(r);this.actions[r.name]=l,(this.emotes.indexOf(r.name)>=0||this.states.indexOf(r.name)>=4)&&(l.clampWhenFinished=!0,l.loop=a.LoopOnce)}this.activeAction=this.actions.Idle,this.activeAction.play(),this.body.scale.set(5,5,5),this.body.traverse(function(e){e instanceof a.Mesh&&(e.castShadow=!0)}),s.add(this.body)}var t,n,o;return t=e,(n=[{key:"update",value:function(e){this.mixer.update(e),this.body.position.copy(this.pos),this.body.rotation.y=this.angle}},{key:"updateByServer",value:function(e,t,n){this.previousAction!==this.actions[n]&&this.fadeToAction(n,.5),this.pos.set(e.x,e.y,e.z),this.angle=t}},{key:"fadeToAction",value:function(e,t){this.previousAction=this.activeAction,this.activeAction=this.actions[e],this.previousAction.fadeOut(t),this.activeAction.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(t).play()}}])&&f(t.prototype,n),o&&f(t,o),e}(),x=parent.socket,D=[],S=parent.ID,P=[];window.addEventListener("resize",function(){var e=window.innerWidth,t=window.innerHeight;v.aspect=e/t,v.updateProjectionMatrix(),y.setSize(e,t)},!1);for(var k=[],A=0;A<10;A++)k.push(new Promise(function(e,t){(new p.a).load("/model/RobotExpressive.glb",function(t){console.log("complete loader"),e(t)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){t(e)})}));function _(){l.update(),h.update();var e=w.getDelta();l.pressed("W")&&x.emit("Client_pressed_W",{ID:S}),l.pressed("A")&&x.emit("Client_pressed_A",{ID:S}),l.pressed("S")&&x.emit("Client_pressed_S",{ID:S}),l.pressed("D")&&x.emit("Client_pressed_D",{ID:S}),l.down("Q")&&x.emit("Client_down_Q",{ID:S}),l.down("shift")&&x.emit("Client_down_shift",{ID:S}),l.up("shift")&&x.emit("Client_up_shift",{ID:S}),x.emit("Client_update",{ID:S},function(e){for(var t=0;t<e.allPlayerData.length;t++)console.log(e),P[t]&&e.allPlayerData[t]?P[t].updateByServer(e.allGameData[t].pos,e.allGameData[t].angle,e.allGameData[t].actionName):e.allPlayerData[t]&&void 0===P[t]?(P[t]=new b(D[parent.userNum++],e.allPlayerData[t].name,void 0),P[t].updateByServer(e.allGameData[t].pos,e.allGameData[t].angle,e.allGameData[t].actionName)):null===e.allPlayerData[t]&&P[t]&&(s.remove(P[t].body),P[t]=void 0)}),P.forEach(function(t){t&&t.update(e)}),requestAnimationFrame(_),y.render(s,v)}Promise.all(k).then(new Promise(function(e){x.emit("initClient",{},function(t){console.log("socket init complete"),m=t,e()})})).then(function(e){D=e,function(){s=new a.Scene,l=new d,s.background=new a.Color(8947848),w=new a.Clock,(h=new i.a).domElement.style.position="absolute",h.domElement.style.top="0px",h.domElement.style.zIndex=100,document.body.appendChild(h.domElement),(y=new a.WebGLRenderer({ambient:!0})).setSize(window.innerWidth,window.innerHeight),y.shadowMap.enabled=!0,document.body.appendChild(y.domElement),s.add(new a.GridHelper(500,50,"red","white")),v=new a.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1e3),(g=new a.DirectionalLight(16777215)).position.set(500,300,500),g.castShadow=!0,g.shadow.mapSize.width=g.shadow.mapSize.height=2048,g.shadow.camera.left=g.shadow.camera.bottom=-500,g.shadow.camera.right=g.shadow.camera.top=500,g.shadow.camera.far=3e3,g.shadow.bias=.5,s.add(g,new a.AmbientLight(2236962));var e=new a.Mesh(new a.PlaneGeometry(500,500),new a.MeshPhongMaterial);e.rotation.x=-Math.PI/2,e.receiveShadow=!0,s.add(e);for(var t=0,n=0;t<m.allPlayerData.length;t++)console.log(m.allPlayerData.length),void 0!==m.allPlayerData[t]&&(console.log(m),P[t]=t!==S?new b(D[n],m.allPlayerData[t].name,void 0):new b(D[n],"",v),n++)}(),_()}).catch(function(e){return console.log(e)})}]);
//# sourceMappingURL=main.bundle.js.map